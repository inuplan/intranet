"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e["default"]:e}function union(e,t,r){for(var n=e.concat(t),o=0;o<n.length;o++)for(var a=o+1;a<n.length;a++)r(n[o],n[a])&&(n.splice(a,1),a--);return n}function setCurrentUserId(e){return{type:SET_CURRENT_USER_ID,id:e}}function addUser(e){return{type:ADD_USER,user:e}}function recievedUsers(e){return{type:RECIEVED_USERS,users:e}}function fetchCurrentUser(e){return function(t){var r=getUrl(e),n=responseHandler.bind(this,t);return fetch(r,options).then(n).then(function(e){t(setCurrentUserId(e.ID)),t(addUser(e))},onReject)}}function fetchUsers(){return function(e){var t=responseHandler.bind(this,e);return fetch(globals.urls.users,options).then(t).then(function(t){return e(recievedUsers(t))},onReject)}}function addLatest(e){return{type:ADD_LATEST,latest:e}}function setSKip(e){return{type:SET_SKIP_WHATS_NEW,skip:e}}function setTake(e){return{type:SET_TAKE_WHATS_NEW,take:e}}function setPage(e){return{type:SET_PAGE_WHATS_NEW,page:e}}function setTotalPages(e){return{type:SET_TOTAL_PAGES_WHATS_NEW,totalPages:e}}function fetchLatestNews(e,t){return function(r){var n=globals.urls.whatsnew+"?skip="+e+"&take="+t,o=responseHandler.bind(this,r);return fetch(n,options).then(o).then(function(n){var o=n.CurrentItems;o.forEach(function(e){var t=e.Item.Author;t&&r(addUser(t))}),r(setSKip(e)),r(setTake(t)),r(setPage(n.CurrentPage)),r(setTotalPages(n.TotalPages));var a=o.filter(function(e){return Boolean(e.Item.Author)}).map(normalizeLatest);r(addLatest(a))},onReject)}}function setImagesOwner(e){return{type:SET_IMAGES_OWNER,id:e}}function recievedUserImages(e){return{type:RECIEVED_USER_IMAGES,images:e}}function addImage(e){return{type:ADD_IMAGE,image:e}}function removeImage(e){return{type:REMOVE_IMAGE,id:e}}function addSelectedImageId(e){return{type:ADD_SELECTED_IMAGE_ID,id:e}}function removeSelectedImageId(e){return{type:REMOVE_SELECTED_IMAGE_ID,id:e}}function clearSelectedImageIds(){return{type:CLEAR_SELECTED_IMAGE_IDS}}function deleteImage(e,t){return function(r){var n=globals.urls.images+"?username="+t+"&id="+e,o=Object.assign({},options,{method:"DELETE"}),a=responseHandler.bind(this,r);return fetch(n,o).then(a).then(function(){return r(removeImage(e))},onReject)}}function uploadImage(e,t){return function(r){var n=globals.urls.images+"?username="+e,o=Object.assign({},options,{method:"POST",body:t}),a=responseHandler.bind(this,r);return fetch(n,o).then(a).then(function(){return r(fetchUserImages(e))},onReject)}}function fetchUserImages(e){return function(t,r){var n=globals.urls.images+"?username="+e,o=responseHandler.bind(this,t),a=function(e){var r=e.map(normalizeImage).reverse();t(recievedUserImages(r))};return fetch(n,options).then(o).then(a,onReject)}}function deleteImages(e,t){return void 0===t&&(t=[]),function(r){var n=t.join(),o=globals.urls.images+"?username="+e+"&ids="+n,a=Object.assign({},options,{method:"DELETE"}),s=responseHandler.bind(this,r);return fetch(o,a).then(s).then(function(){return r(clearSelectedImageIds())},onReject).then(function(){return r(fetchUserImages(e))})}}function setImageOwner(e){return function(t,r){var n=function(){return underscore.find(r().usersInfo.users,function(t){return t.Username==e})},o=n();if(o){var a=o.ID;return t(setImagesOwner(a)),Promise.resolve()}var s=globals.urls.users+"?username="+e,c=responseHandler.bind(this,t);return fetch(s,options).then(c).then(function(e){return t(addUser(e))},onReject).then(function(){o=n(),t(setImagesOwner(o.ID))})}}function fetchSingleImage(e){return function(t,r){var n=globals.urls.images+"/getbyid?id="+e,o=responseHandler.bind(this,t);return fetch(n,options).then(o).then(function(e){if(e){var r=normalizeImage(e);t(addImage(r))}})}}function setCurrentPage(e){return{type:SET_CURRENT_PAGE,page:e}}function setTotalPages$1(e){return{type:SET_TOTAL_PAGES,totalPages:e}}function receivedComments(e){return{type:RECIEVED_COMMENTS,comments:e}}function setFocusedComment(e){return{type:SET_FOCUSED_COMMENT,id:e}}function fetchComments(e,t,r){return function(n,o){var a=globals.urls.comments+"?imageId="+e+"&skip="+t+"&take="+r,s=responseHandler.bind(this,n);return fetch(a,options).then(s).then(function(e){var o=e.CurrentItems;n(receivedComments(void 0)),n(setSkipComments(t)),n(setTakeComments(r)),n(setCurrentPage(e.CurrentPage)),n(setTotalPages$1(e.TotalPages));var a=o.map(normalizeComment);n(receivedComments(a))},onReject)}}var React=_interopDefault(require("react")),ReactDOM=_interopDefault(require("react-dom")),reactRedux=require("react-redux"),redux=require("redux"),thunk=_interopDefault(require("redux-thunk")),underscore=require("underscore"),marked=_interopDefault(require("marked")),removeMd=_interopDefault(require("remove-markdown")),reactRouter=require("react-router"),fetch=_interopDefault(require("isomorphic-fetch")),reactBootstrap=require("react-bootstrap"),SET_SELECTED_IMG="SET_SELECTED_IMG",ADD_IMAGE="ADD_IMAGE",REMOVE_IMAGE="REMOVE_IMAGE",SET_IMAGES_OWNER="SET_IMAGES_OWNER",RECIEVED_USER_IMAGES="RECIEVED_USER_IMAGES",ADD_SELECTED_IMAGE_ID="ADD_SELECTED_IMAGE_ID",REMOVE_SELECTED_IMAGE_ID="REMOVE_SELECTED_IMAGE_ID",CLEAR_SELECTED_IMAGE_IDS="CLEAR_SELECTED_IMAGE_IDS",SET_CURRENT_USER_ID="SET_CURRENT_USER_ID",ADD_USER="ADD_USER",RECIEVED_USERS="RECIEVED_USERS",ADD_COMMENT="ADD_COMMENT",RECIEVED_COMMENTS="RECIEVED_COMMENTS",SET_CURRENT_PAGE="SET_CURRENT_PAGE",SET_TOTAL_PAGES="SET_TOTAL_PAGES",SET_SKIP_COMMENTS="SET_SKIP_COMMENTS",SET_TAKE_COMMENTS="SET_TAKE_COMMENTS",INCR_COMMENT_COUNT="INCR_COMMENT_COUNT",DECR_COMMENT_COUNT="DECR_COMMENT_COUNT",SET_FOCUSED_COMMENT="SET_FOCUSED_COMMENT",ADD_LATEST="ADD_LATEST",SET_SKIP_WHATS_NEW="SET_SKIP_WHATS_NEW",SET_TAKE_WHATS_NEW="SET_TAKE_WHATS_NEW",SET_PAGE_WHATS_NEW="SET_PAGE_WHATS_NEW",SET_TOTAL_PAGES_WHATS_NEW="SET_TOTAL_PAGES_WHATS_NEW",SET_ERROR_TITLE="SET_ERROR_TITLE",SET_ERROR_MESSAGE="SET_ERROR_MESSAGE",SET_HAS_ERROR="SET_HAS_ERROR",CLEAR_ERROR_TITLE="CLEAR_ERROR_TITLE",CLEAR_ERROR_MESSAGE="CLEAR_ERROR_MESSAGE",setErrorTitle=function(e){return{type:SET_ERROR_TITLE,title:e}},clearErrorTitle=function(){return{type:CLEAR_ERROR_TITLE}},setErrorMessage=function(e){return{type:SET_ERROR_MESSAGE,message:e}},clearErrorMessage=function(){return{type:CLEAR_ERROR_MESSAGE}},clearError=function(){return function(e){return e(clearErrorTitle()),e(clearErrorMessage()),e(setHasError(!1)),Promise.resolve()}},setHasError=function(e){return{type:SET_HAS_ERROR,hasError:e}},setError=function(e){return function(t){return t(setHasError(!0)),t(setErrorTitle(e.title)),t(setErrorMessage(e.message)),Promise.resolve()}},HttpError=function(e,t){this.title=e,this.message=t},normalizeImage=function(e){return{ImageID:e.ImageID,Filename:e.Filename,Extension:e.Extension,OriginalUrl:e.OriginalUrl,PreviewUrl:e.PreviewUrl,ThumbnailUrl:e.ThumbnailUrl,CommentCount:e.CommentCount,Uploaded:new Date(e.Uploaded)}},normalizeComment=function(e){var t=e.Replies?e.Replies:[],r=t.map(normalizeComment),n=e.Deleted?-1:e.Author.ID;return{CommentID:e.ID,AuthorID:n,Deleted:e.Deleted,PostedOn:e.PostedOn,Text:e.Text,Replies:r}},normalizeLatest=function(e){var t=null;if(1==e.Type){var r=e.Item;t={Extension:r.Extension,Filename:r.Filename,ImageID:r.ImageID,OriginalUrl:r.OriginalUrl,PreviewUrl:r.PreviewUrl,ThumbnailUrl:r.ThumbnailUrl,Uploaded:r.Uploaded}}else if(2==e.Type){var n=e.Item;t={ID:n.ID,Text:n.Text,ImageID:n.ImageID,ImageUploadedBy:n.ImageUploadedBy}}return{ID:e.ID,Type:e.Type,Item:t,On:e.On,AuthorID:e.Item.Author.ID}},userEquality=function(e,t){return!(!t||!e)&&e.ID==t.ID},formatText=function(e){if(e){var t=marked(e,{sanitize:!0});return{__html:t}}},getWords=function(e,t){if(!e)return"";var r=removeMd(e);return r.split(/\s+/).slice(0,t).join(" ")},timeText=function(e){var t=moment(e).fromNow(),r=moment().diff(e,"hours",!0);if(r>=12.5){var n=moment(e);return"d. "+n.format("D MMM YYYY ")+"kl. "+n.format("H:mm")}return"for "+t},responseHandler=function(e,t){if(t.ok)return t.json();switch(t.status){case 400:e(setError(new HttpError("400 Bad Request","The request was not well-formed")));break;case 404:e(setError(new HttpError("404 Not Found","Could not find resource")));break;case 408:e(setError(new HttpError("408 Request Timeout","The server did not respond in time")));case 500:e(setError(new HttpError("500 Server Error","Something went wrong with the API-server")));break;default:e(setError(new HttpError("Oops","Something went wrong!")))}return Promise.reject()},onReject=function(){},users=function(e,t){switch(void 0===e&&(e=[]),t.type){case ADD_USER:return union(e,[t.user],userEquality);case RECIEVED_USERS:return t.users;default:return e}},currentUserId=function(e,t){switch(void 0===e&&(e=-1),t.type){case SET_CURRENT_USER_ID:return t.id||-1;default:return e}},usersInfo=redux.combineReducers({currentUserId:currentUserId,users:users}),ownerId=function(e,t){switch(void 0===e&&(e=-1),t.type){case SET_IMAGES_OWNER:return t.id||-1;default:return e}},images=function(e,t){switch(void 0===e&&(e=[]),t.type){case ADD_IMAGE:return union(e,[t.image],function(e,t){return e.ImageID==t.ImageID});case RECIEVED_USER_IMAGES:return t.images;case REMOVE_IMAGE:return e.filter(function(e){return e.ImageID!=t.id});case INCR_COMMENT_COUNT:return e.map(function(e){return e.ImageID==t.imageId&&e.CommentCount++,e});case DECR_COMMENT_COUNT:return e.map(function(e){return e.ImageID==t.imageId&&e.CommentCount--,e});default:return e}},selectedImageId=function(e,t){switch(void 0===e&&(e=-1),t.type){case SET_SELECTED_IMG:return t.id||-1;default:return e}},selectedImageIds=function(e,t){switch(void 0===e&&(e=[]),t.type){case ADD_SELECTED_IMAGE_ID:return union(e,[t.id],function(e,t){return e==t});case REMOVE_SELECTED_IMAGE_ID:return underscore.filter(e,function(e){return e!=t.id});case CLEAR_SELECTED_IMAGE_IDS:return[];default:return e}},imagesInfo=redux.combineReducers({ownerId:ownerId,images:images,selectedImageId:selectedImageId,selectedImageIds:selectedImageIds}),comments=function(e,t){switch(void 0===e&&(e=[]),t.type){case RECIEVED_COMMENTS:return t.comments||[];case ADD_COMMENT:return union(e,[t.comment],function(e,t){return e.CommentID==t.CommentID});default:return e}},skip=function(e,t){switch(void 0===e&&(e=0),t.type){case SET_SKIP_COMMENTS:return t.skip||0;default:return e}},take=function(e,t){switch(void 0===e&&(e=10),t.type){case SET_TAKE_COMMENTS:return t.take||10;default:return e}},page=function(e,t){switch(void 0===e&&(e=1),t.type){case SET_CURRENT_PAGE:return t.page||1;default:return e}},totalPages=function(e,t){switch(void 0===e&&(e=0),t.type){case SET_TOTAL_PAGES:return t.totalPages||0;default:return e}},focusedComment=function(e,t){switch(void 0===e&&(e=-1),t.type){case SET_FOCUSED_COMMENT:return t.id||-1;default:return e}},commentsInfo=redux.combineReducers({comments:comments,skip:skip,take:take,page:page,totalPages:totalPages,focusedComment:focusedComment}),title=function(e,t){switch(void 0===e&&(e=""),t.type){case SET_ERROR_TITLE:return t.title||"";default:return e}},message$1=function(e,t){switch(void 0===e&&(e=""),t.type){case SET_ERROR_MESSAGE:return t.message||"";default:return e}},errorInfo=redux.combineReducers({title:title,message:message$1}),hasError=function(e,t){switch(void 0===e&&(e=!1),t.type){case SET_HAS_ERROR:return t.hasError;default:return e}},message=function(e,t){switch(void 0===e&&(e=""),t.type){default:return e}},done=function(e,t){switch(void 0===e&&(e=!0),t.type){default:return e}},statusInfo=redux.combineReducers({hasError:hasError,errorInfo:errorInfo,message:message,done:done}),skip$1=function(e,t){switch(void 0===e&&(e=0),t.type){case SET_SKIP_WHATS_NEW:return t.skip||0;default:return e}},take$1=function(e,t){switch(void 0===e&&(e=10),t.type){case SET_TAKE_WHATS_NEW:return t.take||10;default:return e}},page$1=function(e,t){switch(void 0===e&&(e=1),t.type){case SET_PAGE_WHATS_NEW:return t.page||1;default:return e}},totalPages$1=function(e,t){switch(void 0===e&&(e=0),t.type){case SET_TOTAL_PAGES_WHATS_NEW:return t.totalPages||0;default:return e}},items=function(e,t){switch(void 0===e&&(e=[]),t.type){case ADD_LATEST:return t.latest||[];default:return e}},whatsNewInfo=redux.combineReducers({skip:skip$1,take:take$1,page:page$1,totalPages:totalPages$1,items:items}),rootReducer=redux.combineReducers({usersInfo:usersInfo,imagesInfo:imagesInfo,commentsInfo:commentsInfo,statusInfo:statusInfo,whatsNewInfo:whatsNewInfo}),store=redux.createStore(rootReducer,redux.applyMiddleware(thunk)),options={mode:"cors",credentials:"include"},getUrl=function(e){return globals.urls.users+"?username="+e},NavLink=function(e){function t(t,r){e.call(this,t)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.render=function(){var e=this.context.router.isActive(this.props.to,!0),t=e?"active":"";return React.createElement("li",{className:t},React.createElement(reactRouter.Link,this.props,this.props.children))},t}(React.Component);NavLink.contextTypes={router:React.PropTypes.object};var IndexNavLink=function(e){function t(t,r){e.call(this,t)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.render=function(){var e=this.context.router.isActive(this.props.to,!0),t=e?"active":"";return React.createElement("li",{className:t},React.createElement(reactRouter.IndexLink,this.props,this.props.children))},t}(React.Component);IndexNavLink.contextTypes={router:React.PropTypes.object};var Error$1=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.render=function(){var e=this.props,t=e.clearError,r=e.title,n=e.message;return React.createElement(reactBootstrap.Row,null,React.createElement(reactBootstrap.Col,{lgOffset:2,lg:8},React.createElement(reactBootstrap.Alert,{bsStyle:"danger",onDismiss:t},React.createElement("strong",null,r),React.createElement("p",null,n))))},t}(React.Component),mapStateToProps=function(e){var t=e.usersInfo.users.filter(function(e){return e.Username.toUpperCase()==globals.currentUsername.toUpperCase()})[0],r=t?t.FirstName:"User";return{hasError:e.statusInfo.hasError,error:e.statusInfo.errorInfo,name:r}},mapDispatchToProps=function(e){return{clearError:function(){return e(clearError())}}},Shell=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.errorView=function(){var e=this.props,t=e.hasError,r=e.clearError,n=e.error,o=n.title,a=n.message;return t?React.createElement(Error$1,{title:o,message:a,clearError:r}):null},t.prototype.render=function(){var e=this.props,t=e.name;return React.createElement(reactBootstrap.Grid,{fluid:!0},React.createElement(reactBootstrap.Navbar,null,React.createElement(reactBootstrap.Navbar.Header,null,React.createElement(reactBootstrap.Navbar.Brand,null,React.createElement(reactRouter.Link,{to:"/",className:"navbar-brand"},"Inuplan Intranet")),React.createElement(reactBootstrap.Navbar.Toggle,null)),React.createElement(reactBootstrap.Navbar.Collapse,null,React.createElement(reactBootstrap.Nav,null,React.createElement(IndexNavLink,{to:"/"},"Forside"),React.createElement(NavLink,{to:"/users"},"Brugere"),React.createElement(NavLink,{to:"/about"},"Om")),React.createElement(reactBootstrap.Navbar.Text,{pullRight:!0},"Hej, ",t,"!"))),this.errorView(),this.props.children)},t}(React.Component),Main=reactRedux.connect(mapStateToProps,mapDispatchToProps)(Shell),About=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.componentDidMount=function(){document.title="Om"},t.prototype.render=function(){return React.createElement(reactBootstrap.Row,null,React.createElement(reactBootstrap.Col,{lgOffset:2,lg:8},React.createElement("p",null,"Dette er en single page application! ",React.createElement("br",null),"Teknologier brugt:"),React.createElement("ul",null,React.createElement("li",null,"React"),React.createElement("li",null,"Redux"),React.createElement("li",null,"React-Bootstrap"),React.createElement("li",null,"ReactRouter"),React.createElement("li",null,"Asp.net Core RC 2"),React.createElement("li",null,"Asp.net Web API 2"))))},t}(React.Component),CommentProfile=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.render=function(){return React.createElement(reactBootstrap.Media.Left,null,React.createElement(reactBootstrap.Image,{src:"/images/person_icon.svg",style:{width:"64px",height:"64px"},className:"media-object"}),this.props.children)},t}(React.Component),WhatsNewItemImage=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.when=function(){var e=this.props,t=e.on;return"uploadede "+timeText(t)},t.prototype.render=function(){var e=this.props,t=e.imageId,r=(e.commentId,e.author),n=(e.filename,e.extension,e.thumbnail),o=r.Username,a=o+"/gallery/image/"+t,s=r.FirstName+" "+r.LastName;return React.createElement(reactBootstrap.Media.ListItem,null,React.createElement(CommentProfile,null),React.createElement(reactBootstrap.Media.Body,null,React.createElement("h5",{className:"media-heading"},s," ",React.createElement("small",null,this.when())),React.createElement(reactRouter.Link,{to:a},React.createElement(reactBootstrap.Image,{src:n,thumbnail:!0}))))},t}(React.Component),WhatsNewItemComment=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.createSummary=function(){var e=this.props,t=e.text;return formatText('"'+getWords(t,5)+'..."')},t.prototype.fullname=function(){var e=this.props,t=e.author;return t.FirstName+" "+t.LastName},t.prototype.when=function(){var e=this.props,t=e.on;return"sagde "+timeText(t)},t.prototype.render=function(){var e=this.props,t=e.imageId,r=e.uploadedBy,n=e.commentId,o=(e.author,r.Username),a=this.fullname(),s=this.createSummary(),c=o+"/gallery/image/"+t+"/comment?id="+n;return React.createElement(reactBootstrap.Media.ListItem,null,React.createElement(CommentProfile,null),React.createElement(reactBootstrap.Media.Body,null,React.createElement("h5",{className:"media-heading"},a," ",React.createElement("small",null,this.when())),React.createElement("em",null,React.createElement("span",{dangerouslySetInnerHTML:s})),React.createElement(reactRouter.Link,{to:c},"Se kommentar")))},t}(React.Component),WhatsNewList=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.constructItems=function(){var e=this.props,t=e.items,r=e.getUser,n=function(e){return"whatsnew_"+e};return t.map(function(e){var t=r(e.AuthorID),o=n(e.ID);switch(e.Type){case 1:return React.createElement(WhatsNewItemImage,{id:e.ID,on:e.On,imageId:e.Item.ImageID,filename:e.Item.Filename,extension:e.Item.Extension,thumbnail:e.Item.ThumbnailUrl,preview:e.Item.PreviewUrl,author:t,key:o});case 2:return React.createElement(WhatsNewItemComment,{id:e.ID,commentId:e.Item.ID,text:e.Item.Text,uploadedBy:e.Item.ImageUploadedBy,imageId:e.Item.ImageID,on:e.On,author:t,key:o})}})},t.prototype.render=function(){var e=this.constructItems();return React.createElement(reactBootstrap.Media.List,null,e)},t}(React.Component),Pagination$1=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.render=function(){var e=this.props,t=e.totalPages,r=e.page,n=e.pageHandle;return t<=1?null:React.createElement(reactBootstrap.Pagination,{prev:!0,next:!0,first:!0,last:!0,ellipsis:!0,boundaryLinks:!0,items:t,maxButtons:5,activePage:r,onSelect:n})},t}(React.Component),mapStateToProps$2=function(e){return{items:e.whatsNewInfo.items,getUser:function(t){return underscore.find(e.usersInfo.users,function(e){return e.ID==t})},skip:e.whatsNewInfo.skip,take:e.whatsNewInfo.take,totalPages:e.whatsNewInfo.totalPages,page:e.whatsNewInfo.page}},mapDispatchToProps$1=function(e){return{getLatest:function(t,r){return e(fetchLatestNews(t,r))}}},WhatsNewContainer=function(e){function t(t){e.call(this,t),this.pageHandle=this.pageHandle.bind(this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.pageHandle=function(e){var t=this.props,r=t.getLatest,n=t.page,o=t.take;if(n!=e){var a=e-1,s=a*o;r(s,o)}},t.prototype.render=function(){var e=this.props,t=e.items,r=e.getUser,n=e.totalPages,o=e.page;return React.createElement(reactBootstrap.Row,null,React.createElement(reactBootstrap.Col,{lg:6},React.createElement("h3",null,"Sidste nyt"),React.createElement(WhatsNewList,{items:t,getUser:r}),React.createElement(Pagination$1,{totalPages:n,page:o,pageHandle:this.pageHandle})))},t}(React.Component),WhatsNew=reactRedux.connect(mapStateToProps$2,mapDispatchToProps$1)(WhatsNewContainer),mapStateToProps$1=function(e){var t=e.usersInfo.users.filter(function(e){return e.Username.toUpperCase()==globals.currentUsername.toUpperCase()})[0],r=t?t.FirstName:"User";return{name:r}},HomeView=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.componentDidMount=function(){document.title="Forside"},t.prototype.render=function(){var e=this.props,t=e.name;return React.createElement(reactBootstrap.Row,null,React.createElement(reactBootstrap.Col,{lgOffset:2,lg:8},React.createElement(reactBootstrap.Jumbotron,null,React.createElement("h1",null,"Velkommen ",React.createElement("small",null,t,"!")),React.createElement("p",{className:"lead"},"Til Inuplans intranet side")),React.createElement(WhatsNew,null)))},t}(React.Component),Home=reactRedux.connect(mapStateToProps$1,null)(HomeView),User=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.render=function(){var e=this.props,t=e.username,r=e.firstName,n=e.lastName,o=e.email,a="mailto:"+o,s="/"+t+"/gallery";return React.createElement(reactBootstrap.Col,{lg:3},React.createElement(UserItem,{title:"Brugernavn"},t),React.createElement(UserItem,{title:"Fornavn"},r),React.createElement(UserItem,{title:"Efternavn"},n),React.createElement(UserItem,{title:"Email"},React.createElement("a",{href:a},o)),React.createElement(UserItem,{title:"Billeder"},React.createElement(reactRouter.Link,{to:s},"Billeder")))},t}(React.Component),UserHeading=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.render=function(){return React.createElement(reactBootstrap.Col,{lg:6},React.createElement("strong",null,this.props.children))},t}(React.Component),UserBody=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.render=function(){return React.createElement(reactBootstrap.Col,{lg:6},this.props.children)},t}(React.Component),UserItem=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.render=function(){var e=this.props,t=e.title;return React.createElement(reactBootstrap.Row,null,React.createElement(UserHeading,null,t),React.createElement(UserBody,null,this.props.children))},t}(React.Component),UserList=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.userNodes=function(){var e=this.props,t=e.users;return t.map(function(e){var t="userId_"+e.ID;return React.createElement(User,{username:e.Username,userId:e.ID,firstName:e.FirstName,lastName:e.LastName,email:e.Email,profileUrl:e.ProfileImage,roles:e.Roles,key:t})})},t.prototype.render=function(){return React.createElement(reactBootstrap.Row,null,this.userNodes())},t}(React.Component),mapUsersToProps=function(e){return{users:e.usersInfo.users}},mapDispatchToProps$2=function(e){return{getUsers:function(){e(fetchUsers())}}},UsersContainer=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.componentDidMount=function(){document.title="Brugere"},t.prototype.render=function(){var e=this.props,t=e.users;return React.createElement(reactBootstrap.Row,null,React.createElement(reactBootstrap.Col,{lgOffset:2,lg:8},React.createElement(reactBootstrap.PageHeader,null,"Inuplan's ",React.createElement("small",null,"brugere")),React.createElement(reactBootstrap.Row,null,React.createElement(UserList,{users:t}))))},t}(React.Component),Users=reactRedux.connect(mapUsersToProps,mapDispatchToProps$2)(UsersContainer),setSelectedImg=function(e){return{type:SET_SELECTED_IMG,id:e}},ImageUpload=function(e){function t(t){e.call(this,t),this.handleSubmit=this.handleSubmit.bind(this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.clearInput=function(e){if(e.value){try{e.value=""}catch(t){}if(e.value){var r=document.createElement("form"),n=e.parentNode,o=e.nextSibling;r.appendChild(e),r.reset(),n.insertBefore(e,o)}}},t.prototype.getFiles=function(){var e=document.getElementById("files");return e?e.files:[]},t.prototype.handleSubmit=function(e){var t=this.props,r=t.uploadImage,n=t.username;e.preventDefault();var o=this.getFiles();if(0!=o.length){for(var a=new FormData,s=0;s<o.length;s++){var c=o[s];a.append("file",c)}r(n,a);var i=document.getElementById("files");this.clearInput(i)}},t.prototype.render=function(){var e=this.props,t=e.hasImages,r=e.deleteSelectedImages;return React.createElement(reactBootstrap.Row,null,React.createElement("br",null),React.createElement(reactBootstrap.Col,{lg:4},React.createElement("form",{onSubmit:this.handleSubmit,id:"form-upload",enctype:"multipart/form-data"},React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"files"},"Upload filer:"),React.createElement("input",{type:"file",className:"form-control",id:"files",name:"files",multiple:!0})),React.createElement(reactBootstrap.Button,{bsStyle:"primary",type:"submit"},"Upload")," ",React.createElement(reactBootstrap.Button,{bsStyle:"danger",disabled:!t,onClick:r},"Slet markeret billeder"))))},t}(React.Component),Image$1=function(e){function t(t){e.call(this,t),this.checkboxHandler=this.checkboxHandler.bind(this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.checkboxHandler=function(e){var t=this.props,r=t.image,n=e.currentTarget.checked;if(n){var o=this.props,a=o.addSelectedImageId;a(r.ImageID)}else{var s=this.props,c=s.removeSelectedImageId;c(r.ImageID)}},t.prototype.commentIcon=function(e){var t=0==e?"col-lg-6 text-muted":"col-lg-6 text-primary",r={className:t};return React.createElement("div",r,React.createElement("span",{className:"glyphicon glyphicon-comment","aria-hidden":"true"})," ",e)},t.prototype.checkboxView=function(){var e=this.props,t=e.canEdit,r=e.imageIsSelected,n=e.image,o=r(n.ImageID);return t?React.createElement(reactBootstrap.Col,{lg:6,className:"pull-right text-right"},React.createElement("label",null,"Slet ",React.createElement("input",{type:"checkbox",onClick:this.checkboxHandler,checked:o}))):null},t.prototype.render=function(){var e=this.props,t=e.image,r=e.username,n=t.CommentCount,o="/"+r+"/gallery/image/"+t.ImageID+"/comments";return React.createElement("div",null,React.createElement(reactRouter.Link,{to:o},React.createElement(reactBootstrap.Image,{src:t.PreviewUrl,thumbnail:!0})),React.createElement(reactBootstrap.Row,null,React.createElement(reactRouter.Link,{to:o},this.commentIcon(n)),this.checkboxView()))},t}(React.Component),elementsPerRow=4,ImageList=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.arrangeArray=function(e){for(var t=e.length,r=Math.ceil(t/elementsPerRow),n=[],o=0,a=0;a<r;a++){o=a*elementsPerRow;var s=o+elementsPerRow,c=s>t;if(c){var i=e.slice(o);n.push(i)}else{var l=e.slice(o,s);n.push(l)}}return n},t.prototype.imagesView=function(e){if(0==e.length)return null;var t=this.props,r=t.addSelectedImageId,n=t.removeSelectedImageId,o=(t.deleteSelectedImages,t.canEdit),a=t.imageIsSelected,s=t.username,c=this.arrangeArray(e),i=c.map(function(e,t){var c=e.map(function(e){return React.createElement(reactBootstrap.Col,{lg:3,key:e.ImageID},React.createElement(Image$1,{image:e,canEdit:o,addSelectedImageId:r,removeSelectedImageId:n,imageIsSelected:a,username:s}))}),i="rowId"+t;return React.createElement(reactBootstrap.Row,{key:i},c)});return i},t.prototype.render=function(){var e=this.props,t=e.images;return React.createElement(reactBootstrap.Row,null,this.imagesView(t))},t}(React.Component),mapStateToProps$3=function(e){var t=e.imagesInfo.ownerId,r=e.usersInfo.currentUserId,n=t>0&&r>0&&t==r;return{images:e.imagesInfo.images,canEdit:n,selectedImageIds:e.imagesInfo.selectedImageIds,getFullname:function(t){var r=e.usersInfo.users.filter(function(e){return e.Username.toUpperCase()==t.toUpperCase()})[0],n=r?r.FirstName+" "+r.LastName:"User";return n.toLocaleLowerCase()}}},mapDispatchToProps$3=function(e){return{uploadImage:function(t,r){e(uploadImage(t,r))},addSelectedImageId:function(t){e(addSelectedImageId(t))},removeSelectedImageId:function(t){e(removeSelectedImageId(t))},deleteImages:function(t,r){e(deleteImages(t,r))},clearSelectedImageIds:function(){e(clearSelectedImageIds())}}},UserImagesContainer=function(e){function t(t){e.call(this,t),this.imageIsSelected=this.imageIsSelected.bind(this),this.deleteSelectedImages=this.deleteSelectedImages.bind(this),this.clearSelected=this.clearSelected.bind(this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.componentDidMount=function(){var e=this.props.params,t=e.username,r=this.props,n=r.router,o=r.route;document.title=t+"'s billeder",n.setRouteLeaveHook(o,this.clearSelected)},t.prototype.clearSelected=function(){var e=this.props,t=e.clearSelectedImageIds;return t(),!0},t.prototype.imageIsSelected=function(e){var t=this.props,r=t.selectedImageIds,n=underscore.find(r,function(t){return t==e});return!!n},t.prototype.deleteSelectedImages=function(){var e=this.props,t=e.selectedImageIds,r=e.deleteImages,n=this.props.params,o=n.username;r(o,t)},t.prototype.uploadView=function(){var e=this.props,t=e.canEdit,r=e.uploadImage,n=e.selectedImageIds,o=this.props.params,a=o.username,s=n.length>0;return t?React.createElement(ImageUpload,{uploadImage:r,username:a,deleteSelectedImages:this.deleteSelectedImages,hasImages:s}):null},t.prototype.render=function(){var e=this.props.params,t=e.username,r=this.props,n=r.images,o=r.getFullname,a=r.canEdit,s=r.addSelectedImageId,c=r.removeSelectedImageId,i=o(t);return React.createElement(reactBootstrap.Row,null,React.createElement(reactBootstrap.Col,{lgOffset:2,lg:8},React.createElement("h1",null,React.createElement("span",{className:"text-capitalize"},i,"'s")," ",React.createElement("small",null,"billede galleri")),React.createElement("hr",null),React.createElement(ImageList,{images:n,canEdit:a,addSelectedImageId:s,removeSelectedImageId:c,imageIsSelected:this.imageIsSelected,username:t}),this.uploadView()),this.props.children)},t}(React.Component),UserImagesRedux=reactRedux.connect(mapStateToProps$3,mapDispatchToProps$3)(UserImagesContainer),UserImages=reactRouter.withRouter(UserImagesRedux),this$1=void 0,setSkipComments=function(e){return{type:SET_SKIP_COMMENTS,skip:e}},setTakeComments=function(e){return{type:SET_TAKE_COMMENTS,take:e}},postComment=function(e,t,r){
return function(n,o){var a=o().commentsInfo,s=a.skip,c=a.take,i=globals.urls.comments,l=new Headers;l.append("Content-Type","application/json");var m=JSON.stringify({Text:t,ImageID:e,ParentID:r}),p=Object.assign({},options,{method:"POST",body:m,headers:l});return fetch(i,p).then(function(){n(incrementCommentCount(e)),n(fetchComments(e,s,c))},onReject)}},editComment=function(e,t,r){return function(n,o){var a=o().commentsInfo,s=a.skip,c=a.take,i=globals.urls.comments+"?imageId="+t,l=new Headers;l.append("Content-Type","application/json");var m=Object.assign({},options,{method:"PUT",body:JSON.stringify({ID:e,Text:r}),headers:l});return fetch(i,m).then(function(){n(fetchComments(t,s,c))},onReject)}},deleteComment=function(e,t){return function(r,n){var o=n().commentsInfo,a=o.skip,s=o.take,c=globals.urls.comments+"?commentId="+e,i=Object.assign({},options,{method:"DELETE"});return fetch(c,i).then(function(){r(fetchComments(t,a,s)),r(decrementCommentCount(t))},onReject)}},incrementCommentCount=function(e){return{type:INCR_COMMENT_COUNT,imageId:e}},decrementCommentCount=function(e){return{type:DECR_COMMENT_COUNT,imageId:e}},fetchAndFocusSingleComment=function(e){return function(t,r){var n=globals.urls,o=n.comments,a=o+"/GetSingle?id="+e,s=responseHandler.bind(this$1,t);return fetch(a,options).then(s).then(function(e){var r=normalizeComment(e);t(receivedComments([r])),t(setFocusedComment(r.CommentID))},onReject)}},mapStateToProps$4=function(e){var t=e.imagesInfo.ownerId,r=e.usersInfo.currentUserId,n=t>0&&r>0&&t==r,o=function(t){return underscore.find(e.imagesInfo.images,function(e){return e.ImageID==t})},a=function(){return o(e.imagesInfo.selectedImageId)},s=function(){return a()?a().Filename:""},c=function(){return a()?a().PreviewUrl:""},i=function(){return a()?a().Extension:""},l=function(){return a()?a().OriginalUrl:""},m=function(){return a()?a().Uploaded:new Date};return{canEdit:n,hasImage:function(){return Boolean(o(e.imagesInfo.selectedImageId))},filename:s(),previewUrl:c(),extension:i(),originalUrl:l(),uploaded:m()}},mapDispatchToProps$4=function(e){return{setSelectedImageId:function(t){e(setSelectedImg(t))},deselectImage:function(){e(setSelectedImg(void 0))},setError:function(t){e(setError(t))},fetchImage:function(t){e(fetchSingleImage(t))},deleteImage:function(t,r){e(deleteImage(t,r))},resetComments:function(){e(setSkipComments(void 0)),e(setTakeComments(void 0)),e(setFocusedComment(void 0)),e(receivedComments(void 0))}}},ModalImage=function(e){function t(t){e.call(this,t),this.deleteImageHandler=this.deleteImageHandler.bind(this),this.close=this.close.bind(this),this.seeAllCommentsView=this.seeAllCommentsView.bind(this),this.reload=this.reload.bind(this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.close=function(){var e=this.props,t=e.deselectImage,r=e.resetComments,n=this.props.params,o=n.username,a=this.props.router,s=a.push;t();var c="/"+o+"/gallery";r(),s(c)},t.prototype.deleteImageHandler=function(){var e=this.props,t=e.deleteImage,r=e.setSelectedImageId,n=this.props.params,o=n.id,a=n.username;t(o,a),r(-1)},t.prototype.deleteImageView=function(){var e=this.props,t=e.canEdit;return t?React.createElement(reactBootstrap.Button,{bsStyle:"danger",onClick:this.deleteImageHandler},"Slet billede"):null},t.prototype.reload=function(){var e=this.props.params,t=e.id,r=e.username,n=this.props.router,o=n.push,a="/"+r+"/gallery/image/"+t+"/comments";o(a)},t.prototype.seeAllCommentsView=function(){var e=!Boolean(this.props.children);return e?React.createElement("p",{className:"text-center"},React.createElement(reactBootstrap.Button,{onClick:this.reload},React.createElement(reactBootstrap.Glyphicon,{glyph:"refresh"})," Se alle kommentarer?")):null},t.prototype.render=function(){var e=this.props,t=e.filename,r=e.previewUrl,n=e.extension,o=e.originalUrl,a=e.uploaded,s=e.hasImage,c=s(),i=t+"."+n,l=moment(a),m="Uploaded d. "+l.format("D MMM YYYY ")+"kl. "+l.format("H:mm");return React.createElement(reactBootstrap.Modal,{show:c,onHide:this.close,bsSize:"large",animation:!0},React.createElement(reactBootstrap.Modal.Header,{closeButton:!0},React.createElement(reactBootstrap.Modal.Title,null,i,React.createElement("span",null,React.createElement("small",null," - ",m)))),React.createElement(reactBootstrap.Modal.Body,null,React.createElement("a",{href:o,target:"_blank",rel:"noopener"},React.createElement(reactBootstrap.Image,{src:r,responsive:!0,className:"center-block"}))),React.createElement(reactBootstrap.Modal.Footer,null,this.seeAllCommentsView(),this.props.children,React.createElement("hr",null),React.createElement(reactBootstrap.ButtonToolbar,{style:{"float":"right"}},this.deleteImageView(),React.createElement(reactBootstrap.Button,{onClick:this.close},"Luk"))))},t}(React.Component),SelectedImageRedux=reactRedux.connect(mapStateToProps$4,mapDispatchToProps$4)(ModalImage),SelectedImage=reactRouter.withRouter(SelectedImageRedux),CommentDeleted=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.render=function(){var e=this.props,t=e.replies,r=e.construct,n=t.map(function(e){return r(e)});return React.createElement(reactBootstrap.Media,null,React.createElement(reactBootstrap.Media.Left,{style:{minWidth:"74px"}}),React.createElement(reactBootstrap.Media.Body,null,React.createElement("small",null,"slettet"),n))},t}(React.Component),mapStateToProps$6=function(e){return{canEdit:function(t){return e.usersInfo.currentUserId==t},imageId:e.imagesInfo.selectedImageId,skip:e.commentsInfo.skip,take:e.commentsInfo.take}},mapDispatchToProps$6=function(e){return{editComment:function(t,r,n){return e(editComment(t,r,n))},deleteComment:function(t,r){return e(deleteComment(t,r))},replyComment:function(t,r,n){return e(postComment(t,r,n))},loadComments:function(t,r,n){e(fetchComments(t,r,n))}}},CommentControlsContainer=function(e){function t(t){e.call(this,t),this.state={text:t.text,replyText:"",reply:!1,edit:!1},this.toggleEdit=this.toggleEdit.bind(this),this.toggleReply=this.toggleReply.bind(this),this.editHandle=this.editHandle.bind(this),this.replyHandle=this.replyHandle.bind(this),this.deleteHandle=this.deleteHandle.bind(this),this.handleTextChange=this.handleTextChange.bind(this),this.handleReplyChange=this.handleReplyChange.bind(this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.reload=function(){var e=this.props,t=e.loadComments,r=e.imageId,n=e.skip,o=e.take;t(r,n,o)},t.prototype.handleTextChange=function(e){this.setState({text:e.target.value})},t.prototype.handleReplyChange=function(e){this.setState({replyText:e.target.value})},t.prototype.toggleEdit=function(){var e=this.state,t=e.edit;if(this.setState({edit:!t}),!t){var r=this.props,n=r.text;this.setState({text:n})}},t.prototype.toggleReply=function(){var e=this.state,t=e.reply;this.setState({reply:!t})},t.prototype.deleteHandle=function(){var e=this.props,t=e.deleteComment,r=e.commentId,n=e.imageId;t(r,n),this.reload()},t.prototype.editHandle=function(){var e=this.props,t=e.editComment,r=e.imageId,n=e.commentId,o=this.state,a=o.text;this.setState({edit:!1}),t(n,r,a),this.reload()},t.prototype.replyHandle=function(){var e=this.props,t=e.commentId,r=e.imageId,n=e.replyComment,o=this.state,a=o.replyText;this.setState({reply:!1,replyText:""}),n(r,a,t),this.reload()},t.prototype.render=function(){var e=this.props,t=(e.commentId,e.authorId),r=e.canEdit,n=this.state,o=n.edit,a=n.text,s=n.reply,c=n.replyText,i=r(t);return React.createElement(reactBootstrap.Row,null,React.createElement(reactBootstrap.Row,{style:{paddingBottom:"5px",paddingLeft:"15px"}},React.createElement(reactBootstrap.Col,{lg:4},React.createElement(reactBootstrap.ButtonToolbar,null,React.createElement(reactBootstrap.ButtonGroup,null,React.createElement(ButtonTooltip,{bsStyle:"primary",onClick:this.deleteHandle,icon:"trash",tooltip:"slet",mount:i}),React.createElement(ButtonTooltip,{bsStyle:"primary",onClick:this.toggleEdit,icon:"pencil",tooltip:"ændre",active:o,mount:i}),React.createElement(ButtonTooltip,{bsStyle:"primary",onClick:this.toggleReply,icon:"envelope",tooltip:"svar",active:s,mount:!0}))))),React.createElement(reactBootstrap.Row,{style:{paddingBottom:"5px"}},React.createElement(reactBootstrap.Col,{lgOffset:1,lg:10},React.createElement(CollapseTextArea,{show:o,id:"editTextControl",value:a,onChange:this.handleTextChange,toggle:this.toggleEdit,save:this.editHandle,saveText:"Gem ændringer",mount:i}))),React.createElement(reactBootstrap.Row,null,React.createElement(reactBootstrap.Col,{lgOffset:1,lg:10},React.createElement(CollapseTextArea,{show:s,id:"replyTextControl",value:c,onChange:this.handleReplyChange,toggle:this.toggleReply,save:this.replyHandle,saveText:"Svar",mount:!0}))))},t}(React.Component),CommentControls=reactRedux.connect(mapStateToProps$6,mapDispatchToProps$6)(CommentControlsContainer),CollapseTextArea=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.render=function(){var e=this.props,t=e.show,r=e.id,n=e.value,o=e.onChange,a=e.toggle,s=e.save,c=e.saveText,i=e.mount;return i?React.createElement(reactBootstrap.Collapse,{"in":t},React.createElement(reactBootstrap.FormGroup,{controlId:r},React.createElement(reactBootstrap.FormControl,{componentClass:"textarea",value:n,onChange:o,rows:"4"}),React.createElement("br",null),React.createElement(reactBootstrap.Button,{onClick:a},"Luk"),React.createElement(reactBootstrap.Button,{type:"submit",bsStyle:"info",onClick:s},c))):null},t}(React.Component),ButtonTooltip=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.render=function(){var e=this.props,t=e.tooltip,r=e.onClick,n=e.icon,o=e.bsStyle,a=e.active,s=e.mount,c=React.createElement(reactBootstrap.Tooltip,{id:"tooltip"},t);return s?React.createElement(reactBootstrap.OverlayTrigger,{placement:"top",overlay:c},React.createElement(reactBootstrap.Button,{bsStyle:o,bsSize:"xsmall",onClick:r,active:a},React.createElement(reactBootstrap.Glyphicon,{glyph:n}))):null},t}(React.Component),Comment=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.ago=function(){var e=this.props,t=e.postedOn;return timeText(t)},t.prototype.render=function(){var e=this.props,t=e.name,r=e.text,n=e.commentId,o=e.replies,a=e.construct,s=e.authorId,c=formatText(r),i=o.map(function(e){return a(e)});return React.createElement(reactBootstrap.Media,null,React.createElement(CommentProfile,null),React.createElement(reactBootstrap.Media.Body,null,React.createElement("h5",{className:"media-heading"},React.createElement("strong",null,t)," ",React.createElement("small",null,"sagde ",this.ago())),React.createElement("span",{dangerouslySetInnerHTML:c}),React.createElement(CommentControls,{authorId:s,commentId:n,text:r}),i))},t}(React.Component),CommentList=function(e){function t(t){e.call(this,t),this.constructComment=this.constructComment.bind(this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.rootComments=function(e){var t=this;if(e)return e.map(function(e){var r=t.constructComment(e);return React.createElement(reactBootstrap.Media.ListItem,{key:"rootComment_"+e.CommentID},r)})},t.prototype.constructComment=function(e){var t="commentId"+e.CommentID;if(e.Deleted)return React.createElement(CommentDeleted,{key:t,construct:this.constructComment,replies:e.Replies});var r=this.props,n=r.getName,o=n(e.AuthorID);return React.createElement(Comment,{key:t,name:o,postedOn:e.PostedOn,authorId:e.AuthorID,text:e.Text,construct:this.constructComment,replies:e.Replies,commentId:e.CommentID})},t.prototype.render=function(){var e=this.props,t=e.comments,r=this.rootComments(t);return React.createElement(reactBootstrap.Media.List,null,r)},t}(React.Component),CommentForm=function(e){function t(t){e.call(this,t),this.state={Text:""},this.postComment=this.postComment.bind(this),this.handleTextChange=this.handleTextChange.bind(this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.postComment=function(e){e.preventDefault();var t=this.props,r=t.postHandle;r(this.state.Text),this.setState({Text:""})},t.prototype.handleTextChange=function(e){this.setState({Text:e.target.value})},t.prototype.render=function(){return React.createElement("form",{onSubmit:this.postComment},React.createElement("label",{htmlFor:"remark"},"Kommentar"),React.createElement("textarea",{className:"form-control",onChange:this.handleTextChange,value:this.state.Text,placeholder:"Skriv kommentar her...",id:"remark",rows:"4"}),React.createElement("br",null),React.createElement("button",{type:"submit",className:"btn btn-primary"},"Send"))},t}(React.Component),mapStateToProps$5=function(e){var t=function(t){return underscore.find(e.usersInfo.users,function(e){return e.ID==t})};return{imageId:e.imagesInfo.selectedImageId,skip:e.commentsInfo.skip,take:e.commentsInfo.take,page:e.commentsInfo.page,totalPages:e.commentsInfo.totalPages,comments:e.commentsInfo.comments,getName:function(e){var r=t(e),n=r.FirstName,o=r.LastName;return n+" "+o},owner:t(e.imagesInfo.ownerId)}},mapDispatchToProps$5=function(e){return{postComment:function(t,r){e(postComment(t,r,null))},fetchComments:function(t,r,n){e(fetchComments(t,r,n))}}},CommentsContainer=function(e){function t(t){e.call(this,t),this.pageHandle=this.pageHandle.bind(this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.pageHandle=function(e){var t=this.props,r=t.owner,n=t.imageId,o=t.page,a=(t.skip,t.take),s=t.fetchComments,c=this.props.router,i=c.push,l=r.Username;if(o!=e){var m="/"+l+"/gallery/image/"+n+"/comments?page="+e;i(m);var p=e-1,u=p*a;s(n,u,a)}},t.prototype.render=function(){var e=this.props,t=e.comments,r=e.getName,n=e.imageId,o=e.page,a=e.totalPages,s=e.postComment;return React.createElement("div",{className:"text-left"},React.createElement(reactBootstrap.Row,null,React.createElement(reactBootstrap.Col,{lgOffset:1,lg:11},React.createElement(CommentList,{comments:t,getName:r}))),React.createElement(reactBootstrap.Row,null,React.createElement(reactBootstrap.Col,{lgOffset:1,lg:10},React.createElement(Pagination$1,{totalPages:a,page:o,pageHandle:this.pageHandle}))),React.createElement("hr",null),React.createElement(reactBootstrap.Row,null,React.createElement(reactBootstrap.Col,{lgOffset:1,lg:10},React.createElement(CommentForm,{postHandle:s.bind(null,n)}))))},t}(React.Component),CommentsRedux=reactRedux.connect(mapStateToProps$5,mapDispatchToProps$5)(CommentsContainer),Comments=reactRouter.withRouter(CommentsRedux),tryGetComment=function(e,t){return void 0===e&&(e=[]),underscore.find(e,function(e){return e.CommentID==t})},tryGetUser=function(e,t){return void 0===e&&(e=[]),underscore.find(e,function(e){return e.ID==t})},mapStateToProps$7=function(e){var t=e.commentsInfo,r=t.comments,n=t.focusedComment,o=e.usersInfo,a=o.users;return{getName:function(e){var t=tryGetUser(a,e);return t?t.FirstName+" "+t.LastName:""},getComment:function(){return tryGetComment(r,n)},imageId:e.imagesInfo.selectedImageId,imageOwner:tryGetUser(a,e.imagesInfo.ownerId)}},SingleCommentRedux=function(e){function t(t){e.call(this,t),this.reload=this.reload.bind(this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.reload=function(){var e=this.props,t=e.imageId,r=e.imageOwner,n=this.props.router,o=n.push,a="/"+r.Username+"/gallery/image/"+t+"/comments";o(a)},t.prototype.render=function(){var e=this.props,t=e.getName,r=e.getComment,n=r();if(!n)return null;var o=n.Text,a=n.AuthorID,s=n.CommentID,c=n.PostedOn,i=t(n.AuthorId);return React.createElement("div",{className:"text-left"},React.createElement(reactBootstrap.Well,null,React.createElement(Comment,{name:i,text:o,commentId:s,replies:[],authorId:a,postedOn:c})),React.createElement("div",null,React.createElement("p",{className:"text-center"},React.createElement(reactBootstrap.Button,{onClick:this.reload},React.createElement(reactBootstrap.Glyphicon,{glyph:"refresh"})," Se alle kommentarer?"))))},t}(React.Component),SingleCommentConnect=reactRedux.connect(mapStateToProps$7,null)(SingleCommentRedux),SingleComment=reactRouter.withRouter(SingleCommentConnect);store.dispatch(fetchCurrentUser(globals.currentUsername)),store.dispatch(fetchUsers()),moment.locale("da");var selectImage=function(e){var t=e.params.id;store.dispatch(setSelectedImg(t))},fetchImages=function(e){var t=e.params.username;store.dispatch(setImageOwner(t)),store.dispatch(fetchUserImages(t)),store.dispatch(setSkipComments(void 0)),store.dispatch(setTakeComments(void 0))},loadComments=function(e){var t=e.params,r=(t.username,t.id),n=e.location.query,o=n.page,a=store.getState().commentsInfo,s=a.skip,c=a.take;if(o){var i=o-1,l=i*c;store.dispatch(fetchComments(r,l,c))}else store.dispatch(fetchComments(r,s,c))},fetchComment=function(e){var t=e.location.query,r=t.id;store.dispatch(fetchAndFocusSingleComment(r))},fetchWhatsNew=function(e){var t=function(e,t){return store.dispatch(fetchLatestNews(e,t))},r=store.getState().whatsNewInfo,n=r.skip,o=r.take;t(n,o)};ReactDOM.render(React.createElement(reactRedux.Provider,{store:store},React.createElement(reactRouter.Router,{history:reactRouter.browserHistory},React.createElement(reactRouter.Route,{path:"/",component:Main},React.createElement(reactRouter.IndexRoute,{component:Home,onEnter:fetchWhatsNew}),React.createElement(reactRouter.Route,{path:"users",component:Users}),React.createElement(reactRouter.Route,{path:"about",component:About}),React.createElement(reactRouter.Route,{path:":username/gallery",component:UserImages,onEnter:fetchImages},React.createElement(reactRouter.Route,{path:"image/:id",component:SelectedImage,onEnter:selectImage},React.createElement(reactRouter.Route,{path:"comments",component:Comments,onEnter:loadComments}),React.createElement(reactRouter.Route,{path:"comment",component:SingleComment,onEnter:fetchComment})))))),document.getElementById("content"));