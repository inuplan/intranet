@model Inuplan.Intranet.ViewModels.BaseViewModel<string>
<h2>Billeder</h2>
<div class="alert alert-danger" role="alert" id="error_container" >
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
    <span id="error_message"></span>
</div>

<!-- ko with: vm -->
<div class="row" data-bind="foreach: images" id="images">
    <div class="col-lg-2 col-sm-3 col-xs-12">
        <a data-bind="click: function(){ show_modal(true) }">
            <img class="thumbnail img-responsive" data-bind="attr: { src: thumbnail_url }" />
        </a>
    </div>
    <div data-bind="template: { name: 'view-image', data: $data }" ></div>
</div>
<!-- /ko -->

@if (Model.IsEditable)
{
    <div class="row">
        <div class="col-md-4 col-md-offset-4">
            <form class="form-inline"
                  id="form-upload"
                  action="@ViewBag.Upload"
                  method="post"
                  enctype="multipart/form-data">
                <input type="file" class="form-control" id="files" name="files" multiple />
                <input type="submit" class="btn btn-primary" id="upload" value="Upload" />
            </form>
        </div>
    </div>
}

@section scripts 
{
    @Scripts.Render("~/bundles/knockout")
    <script src="~/Scripts/Pages/ImageUser.js">
    </script>
    <script>
        $(function () {
            $('#error_container').hide();
            var get_url = '@Model.Entity';
            var app = new AppViewModel(get_url);
            ko.applyBindings(app);

            $('#form-upload').submit(function (event) {
                event.preventDefault();
                var formData = new FormData($(this)[0]);
                $.ajax('@ViewBag.Upload', {
                    xhrFields: {
                        withCredentials: true
                    },
                    type: 'POST',
                    data: formData,
                    cache: false,
                    contentType: false,
                    processData: false,
                    success: function (result, status, jqXhr) {
                        window.location.reload();
                    },
                    error: error_handler
                });
            })
        });

    </script>
    <script type="text/html" id="view-image">
        <!-- Modal -->
        <div class="modal fade" role="dialog" data-bind="modal: show_modal">
            <div class="modal-dialog modal-lg">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title text-center">Filnavn: <span data-bind="text: fullname"></span></h4>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-lg-12">
                                <a data-bind="attr: {href: original_url, target: '_blank'}">
                                    <img class="img-responsive center-block img-rounded" data-bind="attr: {src: preview_url }" />
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Luk</button>
                    </div>
                </div>

            </div>
        </div>
    </script>
}